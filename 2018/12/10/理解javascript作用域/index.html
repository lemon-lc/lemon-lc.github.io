<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>理解 JavaScript 作用域 | lemon&#39;s blog</title>
    <meta name="description" content="JavaScript 定义了一套如何存储以及查找变量的规则，这套规则就是作用域。">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="alternate" type="application/rss+xml" href="https://blog.volc.top/rss.xml" title="lemon&#39;s blog RSS Feed">
    
    <link rel="preload" href="/assets/css/0.styles.41ee851f.css" as="style"><link rel="preload" href="/assets/js/app.9ccd57e4.js" as="script"><link rel="preload" href="/assets/js/5.96c81f65.js" as="script"><link rel="preload" href="/assets/js/30.5c34af22.js" as="script"><link rel="prefetch" href="/assets/js/1.03fbddf5.js"><link rel="prefetch" href="/assets/js/10.86034f06.js"><link rel="prefetch" href="/assets/js/11.7f31882c.js"><link rel="prefetch" href="/assets/js/12.d88e826f.js"><link rel="prefetch" href="/assets/js/13.a7bf8535.js"><link rel="prefetch" href="/assets/js/14.12fd603e.js"><link rel="prefetch" href="/assets/js/15.c74d7ea6.js"><link rel="prefetch" href="/assets/js/16.2303d7bc.js"><link rel="prefetch" href="/assets/js/17.d9cca057.js"><link rel="prefetch" href="/assets/js/18.6b7aa57b.js"><link rel="prefetch" href="/assets/js/19.ff6433ec.js"><link rel="prefetch" href="/assets/js/20.85ea340b.js"><link rel="prefetch" href="/assets/js/21.b8b3dd51.js"><link rel="prefetch" href="/assets/js/22.3330af4f.js"><link rel="prefetch" href="/assets/js/23.b7685245.js"><link rel="prefetch" href="/assets/js/24.76a08b9c.js"><link rel="prefetch" href="/assets/js/25.d7a90f64.js"><link rel="prefetch" href="/assets/js/26.c9a9c704.js"><link rel="prefetch" href="/assets/js/27.f7c580eb.js"><link rel="prefetch" href="/assets/js/28.bc72cf55.js"><link rel="prefetch" href="/assets/js/29.d15156a8.js"><link rel="prefetch" href="/assets/js/31.c08b500b.js"><link rel="prefetch" href="/assets/js/32.3ab46a7d.js"><link rel="prefetch" href="/assets/js/33.3b8f38a5.js"><link rel="prefetch" href="/assets/js/34.cc5f940e.js"><link rel="prefetch" href="/assets/js/4.1edcbb05.js"><link rel="prefetch" href="/assets/js/6.01c2a728.js"><link rel="prefetch" href="/assets/js/7.85506fa1.js"><link rel="prefetch" href="/assets/js/8.dd3aa19b.js"><link rel="prefetch" href="/assets/js/9.a251fd11.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.36420dbc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.41ee851f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">lemon's blog </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">BLOG</a></li><li class="nav-item"><a href="/leetcode/" class="nav-link">LEETCODE</a></li><li class="nav-item"><a href="https://github.com/lemon-lc" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">lemon's blog </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">BLOG</a></li><li class="mobile-nav-item"><a href="/leetcode/" class="nav-link">LEETCODE</a></li><li class="mobile-nav-item"><a href="https://github.com/lemon-lc" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></li> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        理解 JavaScript 作用域
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2018-12-10T00:00:00.000Z">
      Mon Dec 10 2018
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-d832e844><a href="/tag/基础知识" data-v-d832e844> 基础知识 </a></li><li class="post-tag" data-v-d832e844><a href="/tag/作用域" data-v-d832e844> 作用域 </a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>JavaScript 定义了一套如何存储以及查找变量的规则，这套规则就是<strong>作用域</strong>。</p> <p>作用域共有两种主要的工作模型。第一种是最为普遍的，被大多数编程语言所采用的词法作用域，另外一种叫作动态作用域。JavaScript 采用的就是词法作用域。</p> <p>作用域主要有全局作用域、函数作用域以及 ES6 新增的块级作用域。</p> <p>下面我们详细的了解一下上面介绍的作用域。</p> <h3 id="全局作用域"><a href="#全局作用域" class="header-anchor">#</a> 全局作用域</h3> <p>拥有全局作用域的是全局变量。</p> <p>在不用的环境中，全局变量是不同的:</p> <ul><li>在浏览器环境中全局变量是 window</li> <li>在 Node.js 中全局变量是 golbal</li></ul> <p>在浏览器 JS 中我们可以通过 window.spoce 的方式访问全局作用域下的定义的变量。</p> <h3 id="函数作用域"><a href="#函数作用域" class="header-anchor">#</a> 函数作用域</h3> <blockquote><p>函数作用域的含义是指，属于这个函数的全部变量都可以在整个函数的范围内使用及复用(事实上在嵌套的作用域中也可以使用)</p></blockquote> <p>在 JavaScript 中每个函数都会创建一个函数作用域。在函数之外一般是访问不到函数内定义的变量，只能在函数内部进行访问。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> spoce <span class="token operator">=</span> <span class="token string">'fn'</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>spoce<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>spoce<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre></div><p>在上面的代码中<code>1</code> 会打印出 <em>fn</em>,
但是执行到<code>2</code>时会报错 <em style="color:red;">Uncaught ReferenceError: spoce is not defined</em>。</p> <h3 id="块作用域"><a href="#块作用域" class="header-anchor">#</a> 块作用域</h3> <p>在 ES6 之前，JavaScript 不存在块级作用域。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> spoce <span class="token operator">=</span> <span class="token string">'define spoce'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>spoce<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 会发生什么？？？</span>
</code></pre></div><p>如果是块级作用域在外面是不应该访问到 spoce 这个变量，代码就会报错 <em style="color:red;">Uncaught ReferenceError: spoce is not defined</em>。而实际上这段代码会打印出 <em>define spoce</em>，为什么会这样呢？</p> <p>用 var 声明的变量存在<strong>变量提升</strong>的问题。<code>var spoce = 'define spoce'</code>，分为两个部分：<code>var spoce</code> 和 <code>spoce = 'define spoce'</code>，在解析 JS 代码时会把<code>var spoce</code>提升到函数作用域的顶部，在 if 条件语句中只是对其进行了赋值操作。所以上面的代码是在函数作用域中声明了<code>spoce</code>，所以打印的是 <em>define spoce</em>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> spoce <span class="token operator">=</span> <span class="token string">'define spoce'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>spoce<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 又会发生什么？？？</span>
</code></pre></div><p>难道这里不是打印 <em>define spoce</em> 吗?</p> <p>其实代码执行到这里就会报错 <em style="color:red;">Uncaught ReferenceError: spoce is not defined</em> 。</p> <div align="center"><img width="150" height="150" src="https://raw.githubusercontent.com/volcanoliuc/blog/master/images/7e9adf9d26b1a18ffaf7f80129344279.gif"></div> <p>let 关键字会将声明的变量隐式的绑定在所在的块作用域（通常是 {...} 内部），所以在 if {...} 这个块之外是访问不到块作用域的，所以执行到 console.log(spoce) 的时候 <code>spoce</code> 是没有声明的。</p> <p>使用 let 声明变量的时候还要注意的是 let 声明的变量不会变量提升，使用变量必须在声明之后才能使用，否则也是会抛出 <em style="color:red;">Uncaught ReferenceError: spoce is not defined</em>。</p> <p>在 ES6 中还有一个 const 关键字与 let 类似，只是 const 声明变量不能进行修改。</p> <h3 id="作用域链"><a href="#作用域链" class="header-anchor">#</a> 作用域链</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result: '</span><span class="token punctuation">,</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// result: 16</span>
  <span class="token punctuation">}</span>
  <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div align="center"><img height="400" src="https://raw.githubusercontent.com/volcanoliuc/blog/master/images/spoce.png"></div>
变量<code>a</code><code>b</code><code>c</code> 都会查找当前作用域是否存在变量<code>a</code> <code>b</code> 或 <code>c</code>，如果不存在则继续查找父级作用域直至查询到全局作用域为止。这样一套变量的查找规则其实就是作用域链的作用，规定了一个变量能访问的作用域。至于为什么会这样以后有时间再细细研究（内部属性 [[Scope]] 的作用）。
<div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result: '</span><span class="token punctuation">,</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// result: 11</span>
  <span class="token punctuation">}</span>
  <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>作用域查找会在找到第一个匹配标签的时候就结束，因此内外作用域有同名的变量的时候，会产生遮蔽效应，直接采用了内层的同名变量 a。</p> <p>除了 let、const 之外，with 和 try/catch 也会产生块级作用域，这是这两种方法并不推荐使用，如果感兴趣可自行 google。</p> <h3 id="一个面试题"><a href="#一个面试题" class="header-anchor">#</a> 一个面试题</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面打印出来的结果是 <code>10</code>，为什么？
JS 的作用域是静态作用域，变量声明的时候就已经确定了其作用域。fn 的作用域内没有声明 z 变量，就会查找上层作用域即全局作用域。</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>在 JavaScript 中函数作用域是我们最常使用的作用域单元，ES6 流行之后，块级作用域我们使用的也越来越多，let、const 声明的变量会添加到块级作用域中。</p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h3 active"><a href="#全局作用域" title="全局作用域">全局作用域</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#函数作用域" title="函数作用域">函数作用域</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#块作用域" title="块作用域">块作用域</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#作用域链" title="作用域链">作用域链</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#一个面试题" title="一个面试题">一个面试题</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#总结" title="总结">总结</a></div></div></div></div> <footer class="footer" data-v-582f9766><div class="footer-left-wrap" data-v-582f9766><ul class="contact" data-v-582f9766><li class="contact-item" data-v-582f9766><a href="https://github.com/lemon-lc" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-582f9766><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-582f9766><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-582f9766></path></svg>
          
        </a></li><li class="contact-item" data-v-582f9766><a href="mailto:liucannn@sina.com" class="nav-link external" data-v-582f9766><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-582f9766><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-582f9766></path><polyline points="22,6 12,13 2,6" data-v-582f9766></polyline></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-582f9766><ul class="copyright" data-v-582f9766><li class="copyright-item" data-v-582f9766><a href="/2018/12/10/%E7%90%86%E8%A7%A3javascript%E4%BD%9C%E7%94%A8%E5%9F%9F/.html" class="nav-link" data-v-582f9766>Lemon © 2018</a></li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9ccd57e4.js" defer></script><script src="/assets/js/5.96c81f65.js" defer></script><script src="/assets/js/30.5c34af22.js" defer></script>
  </body>
</html>
